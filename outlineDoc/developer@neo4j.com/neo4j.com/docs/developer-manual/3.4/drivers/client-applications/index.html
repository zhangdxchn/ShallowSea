
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta charset="utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1.0"></meta>
      <title>4.2.&nbsp;Client applications - Chapter&nbsp;4.&nbsp;Drivers</title>
      <link rel="stylesheet" type="text/css" href="../../docbook.css"></link>
      <link rel="stylesheet" type="text/css" href="../../../../../../maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"></link>
      <link rel="stylesheet" type="text/css" href="../../../../../../cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css"></link>
      <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,400italic,600,300italic"></link>
      <link rel="stylesheet" type="text/css" href="../../../../../../cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/codemirror.min.css"></link>
      <link rel="stylesheet" type="text/css" href="../../../../../../cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/theme/neo.min.css"></link>
      <link rel="stylesheet" type="text/css" href="../../css/extra.css"></link>
      <link rel="stylesheet" type="text/css" href="../../css/chunked-base.css"></link>
      <link rel="stylesheet" type="text/css" href="../../css/console.css"></link><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js" type="text/javascript"></script><script src="../../../../../../maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" type="text/javascript"></script><script src="../../../../../../cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/codemirror.min.js" type="text/javascript"></script><script src="../../../../../../cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/addon/runmode/runmode.min.js" type="text/javascript"></script><script src="../../../../../../cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/mode/javascript/javascript.min.js" type="text/javascript"></script><script src="../../../../../../cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/mode/shell/shell.min.js" type="text/javascript"></script><script src="../../../../../../cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/mode/python/python.min.js" type="text/javascript"></script><script src="../../../../../../cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/mode/xml/xml.min.js" type="text/javascript"></script><script src="../../../../../../cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/mode/clike/clike.min.js" type="text/javascript"></script><script src="../../../../../../cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/mode/cypher/cypher.min.js" type="text/javascript"></script><script src="../../../../../../cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/mode/properties/properties.min.js" type="text/javascript"></script><script src="../../../../../../cdnjs.cloudflare.com/ajax/libs/codemirror/5.36.0/mode/groovy/groovy.min.js" type="text/javascript"></script><script src="../../javascript/colorize.js" type="text/javascript"></script><script src="../../javascript/tabs-for-chunked.js" type="text/javascript"></script><script src="../../javascript/mp-nav.js" type="text/javascript"></script><script src="../../javascript/versionswitcher.js" type="text/javascript"></script><script src="../../javascript/version.js" type="text/javascript"></script><script src="https://s3-eu-west-1.amazonaws.com/alpha.neohq.net/docs/new-manual/assets/search.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"></meta>
      <meta name="description" content="This section describes how to manage database connections within an application."></meta>
      <link rel="prev" href="../get-started/index.html" title="4.1.&nbsp;Get started"></link>
      <link rel="next" href="../sessions-transactions/index.html" title="4.3.&nbsp;Sessions and transactions"></link>
      <link rel="shortcut icon" href="../../../../../wp-content/themes/neo4jweb/favicon.ico"></link><script>
        $(document).ready(function() {
          CodeMirror.colorize();
          tabTheSource($('body'));
          var $header = $('header').first();
          $header.prepend(
            $('<a href="../../index.html" id="logo"><img src="../../../../../wp-content/themes/neo4jweb/assets/images/neo4j-logo-2015.png" alt="Neo4j Logo"></img></a>')
          );
          var $sidebar = $('<div id="sidebar-wrapper"></div>');
          $.get('toc.html', function (d){
            $(d).appendTo($sidebar);
            highlightToc();
            highlightLibraryHeader();
          });
          $sidebar.insertAfter($('header').first());
        });
        </script></head>
   <body>
      <header>
         <div class="searchbox">
            <form id="search-form" class="search" name="search-form" role="search"><input id="search-form-input" name="q" title="search" type="search" lang="en" placeholder="Search Neo4j docs..." aria-label="Search Neo4j documentation" max-length="128" required="required"></input><input id="search-form-button" type="submit" value="Search"></input></form>
         </div>
         <ul class="documentation-library">
            <li><a href="https://neo4j.com/docs/operations-manual/3.4/">Operations Manual</a></li>
            <li><a href="../../index.html">Developer Manual</a></li>
            <li><a href="https://neo4j.com/docs/ogm-manual/3.0/">OGM Manual</a></li>
            <li><a href="https://neo4j.com/docs/graph-algorithms/3.4/">Graph Algorithms</a></li>
            <li><a href="https://neo4j.com/docs/java-reference/3.4/">Java Reference</a></li>
         </ul>
         <nav id="header-nav"><span class="nav-previous"><a accesskey="p" href="../get-started/index.html"><span class="fa fa-long-arrow-left" aria-hidden="true"></span>Get started</a></span><span class="nav-current">
               <p class="nav-title hidden">4.2.&nbsp;Client applications</p></span><span class="nav-next"><a accesskey="n" href="../sessions-transactions/index.html">Sessions and transactions<span class="fa fa-long-arrow-right" aria-hidden="true"></span></a></span></nav>
      </header>
      <div id="search-results" class="hidden"></div>
      <section class="section" id="driver-client-applications">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title" style="clear: both"><a class="anchor" href="index.html#driver-client-applications"></a>4.2.&nbsp;Client applications
                  </h2>
               </div>
            </div>
         </div>
         <div class="abstract">
            <p>This section describes how to manage database connections within an application.</p>
         </div>
         <section class="section" id="driver-driver-object">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a class="anchor" href="index.html#driver-driver-object"></a>4.2.1.&nbsp;The driver object
                     </h3>
                  </div>
               </div>
            </div>
            <p>A Neo4j client application will require a driver object instance in order to provide access to the database.
               This object instance should be made available to all parts of the application that need to interact with Neo4j.
               In languages where <a class="link" href="../../terminology/index.html#term-thread-safety">thread safety</a> is an issue, the driver can be considered thread-safe.
            </p>
            <div class="admonitionblock tip">
               <table>
                  <tbody>
                     <tr>
                        <td class="icon" rowspan="2"><i class="fa icon-tip" title="tip"></i></td>
                        <th>A note on lifecycle</th>
                     </tr>
                     <tr>
                        <td class="content">
                           <p>Applications will typically construct a driver instance on startup and destroy it on exit.
                              Destroying a driver instance will immediately shut down any connections previously opened via that driver; for drivers that
                              contain a connection pool, the entire pool will be shut down.
                           </p>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </div>
            <p>To construct a driver instance, a <a class="link" href="index.html#driver-connection-uris" title="4.2.2.&nbsp;Connection URIs">connection URI</a> and <a class="link" href="index.html#driver-authentication" title="4.2.3.&nbsp;Authentication">authentication information</a> must be supplied.
               Additional configuration details can be supplied if required.
               All of these details are immutable for the lifetime of the driver.
               Therefore, if multiple configurations are required (such as when working with multiple database users) then multiple driver
               objects must be used.
            </p>
            <p>An example of driver construction and destruction can be seen below:</p>
            <div class="example tabbed-example" id="d0e64682">
               <div class="example-title">Example&nbsp;4.6.&nbsp;The driver lifecycle</div>
               <div class="example tabbed-example-contents">
                  <div class="informalexample include-with-dotnet"><pre class="programlisting highlight"><code data-lang="csharp">public class DriverLifecycleExample : IDisposable
{
    public IDriver Driver { get; }

    public DriverLifecycleExample(string uri, string user, string password)
    {
        Driver = GraphDatabase.Driver(uri, AuthTokens.Basic(user, password));
    }

    public void Dispose()
    {
        Driver?.Dispose();
    }
}</code></pre></div>
                  <div class="informalexample include-with-java"><pre class="programlisting highlight"><code data-lang="java">public class DriverLifecycleExample implements AutoCloseable
{
    private final Driver driver;

    public DriverLifecycleExample( String uri, String user, String password )
    {
        driver = GraphDatabase.driver( uri, AuthTokens.basic( user, password ) );
    }

    @Override
    public void close() throws Exception
    {
        driver.close();
    }
}</code></pre></div>
                  <div class="informalexample include-with-javascript"><pre class="programlisting highlight"><code data-lang="javascript">const driver = neo4j.driver(uri, neo4j.auth.basic(user, password));

driver.onCompleted = () =&gt; {
  console.log('Driver created');
};

driver.onError = error =&gt; {
  console.log(error);
};

const session = driver.session();
session.run('CREATE (i:Item)').then(() =&gt; {
  session.close();

  // ... on application exit:
  driver.close();
});</code></pre></div>
                  <div class="informalexample include-with-python"><pre class="programlisting highlight"><code data-lang="python">class DriverLifecycleExample:
    def __init__(self, uri, user, password):
        self._driver = GraphDatabase.driver(uri, auth=(user, password))

    def close(self):
        self._driver.close()</code></pre></div>
               </div>
            </div>
         </section>
         <section class="section" id="driver-connection-uris">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a class="anchor" href="index.html#driver-connection-uris"></a>4.2.2.&nbsp;Connection URIs
                     </h3>
                  </div>
               </div>
            </div>
            <p>A connection URI identifies a graph database and how to connect to it.
               The official Neo4j drivers currently support the following URI schemes and driver object types:
            </p>
            <div class="table" id="d0e64702">
               <table class="table" summary="Available URI schemes" border="1">
                  <caption class="table-title">Table&nbsp;4.2.&nbsp;Available URI schemes</caption>
                  <colgroup>
                     <col class="col_1"></col>
                     <col class="col_2"></col>
                  </colgroup>
                  <thead>
                     <tr>
                        <th style="text-align: left; vertical-align: top; ">URI Scheme</th>
                        <th style="text-align: left; vertical-align: top; ">Driver object type</th>
                     </tr>
                  </thead>
                  <tbody>
                     <tr>
                        <td style="text-align: left; vertical-align: top; ">
                           <p>bolt</p>
                        </td>
                        <td style="text-align: left; vertical-align: top; ">
                           <p>Direct driver</p>
                        </td>
                     </tr>
                     <tr>
                        <td style="text-align: left; vertical-align: top; ">
                           <p>bolt+routing</p>
                        </td>
                        <td style="text-align: left; vertical-align: top; ">
                           <p>Routing driver</p>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </div>
            <section class="section" id="_direct_drivers_bolt">
               <div class="titlepage">
                  <div>
                     <div>
                        <h4 class="title"><a class="anchor" href="index.html#_direct_drivers_bolt"></a>4.2.2.1.&nbsp;Direct drivers (bolt)
                        </h4>
                     </div>
                  </div>
               </div>
               <p>A Direct driver is created via a <code class="literal">bolt</code> URI, for example: <code class="literal">bolt://localhost:7687</code>.
                  This kind of driver is used to maintain connections to a single database server and is typically used when working with a
                  single Neo4j instance or when targeting a specific member of a cluster.
                  Note that a Routing driver is preferable when working with a causal cluster.
               </p>
            </section>
            <section class="section" id="routing_drivers_bolt_routing">
               <div class="titlepage">
                  <div>
                     <div>
                        <h4 class="title"><a class="anchor" href="index.html#routing_drivers_bolt_routing"></a>4.2.2.2.&nbsp;Routing drivers (bolt+routing)
                        </h4>
                     </div>
                  </div>
               </div>
               <p>A Routing driver is created via a <code class="literal">bolt+routing</code> URI, for example: <code class="literal">bolt+routing://graph.example.com:7687</code>.
                  The address in the URI must be that of a Core server.
                  This kind of driver uses the <a class="link" href="../../terminology/index.html#term-bolt-routing-protocol">Bolt Routing Protocol</a> and works in tandem with the cluster to route transactions to available cluster members.
               </p>
            </section>
            <section class="section" id="_routing_drivers_with_routing_context">
               <div class="titlepage">
                  <div>
                     <div>
                        <h4 class="title"><a class="anchor" href="index.html#_routing_drivers_with_routing_context"></a>4.2.2.3.&nbsp;Routing drivers with routing context
                        </h4>
                     </div>
                  </div>
               </div>
               <p>Routing drivers with routing context are an available option when using drivers of version 1.3 or above together with a Neo4j
                  Causal Cluster of version 3.2 or above.
                  In such a setup, a Routing driver can include a preferred routing context via the query part of the <code class="literal">bolt+routing</code> URI.
               </p>
               <p>In the standard Neo4j configuration, routing contexts are defined on the server side by means of <span class="emphasis"><em>server policies</em></span>.
                  Thus the driver communicates the routing context to the cluster in the form of a server policy.
                  It then obtains refined routing information back from the cluster, based on the server policy.
               </p>
               <p>The address in the URI of a Routing driver with routing context must be that of a Core server.</p>
               <div class="example" id="d0e64769">
                  <div class="example-title">Example&nbsp;4.7.&nbsp;Configure a Routing driver with routing context</div>
                  <div class="example-contents">
                     <p>This example will assume that Neo4j has been configured for server policies as described in <a href="https://neo4j.com/docs/operations-manual/3.4/clustering/multi-data-center/load-balancing/" class="olink">Neo4j Operations Manual &#8594; Load balancing for multi-data center systems</a>.
                        In particular, a server policy called <code class="literal">europe</code> has been defined.
                        Additionally, we have a server <code class="literal">neo01.graph.example.com</code> to which we wish to direct the driver.
                     </p>
                     <p>This URI will use the server policy <code class="literal">europe</code>:
                     </p>
                     <p><code class="literal">bolt+routing://neo01.graph.example.com?policy=europe</code></p>
                  </div>
               </div>
               <div class="admonitionblock note">
                  <table>
                     <tbody>
                        <tr>
                           <td class="icon" rowspan="2"><i class="fa icon-note" title="note"></i></td>
                           <th>Server-side configuration to enable Routing drivers with routing context</th>
                        </tr>
                        <tr>
                           <td class="content">
                              <p>A prerequisite for using a Routing driver with routing context is that the Neo4j database is operated on a <a href="https://neo4j.com/docs/operations-manual/3.4/clustering/" class="olink">Causal Cluster</a> with the <a href="https://neo4j.com/docs/operations-manual/3.4/clustering/multi-data-center/" class="olink">Multi-data center licensing option</a> enabled.
                                 Additionally, the routing contexts must be defined within the cluster as routing <span class="emphasis"><em>policies</em></span>.
                                 For details on how to configure multi-data center routing policies for a Causal Cluster, please refer to <a href="https://neo4j.com/docs/operations-manual/3.4/clustering/multi-data-center/load-balancing/" class="olink">Operations Manual &#8594; Causal Clustering</a>.
                              </p>
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </div>
            </section>
         </section>
         <section class="section" id="driver-authentication">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a class="anchor" href="index.html#driver-authentication"></a>4.2.3.&nbsp;Authentication
                     </h3>
                  </div>
               </div>
            </div>
            <p>Authentication details are provided as an auth token which contains the user names, passwords or other credentials required
               to access the database.
               Neo4j supports multiple authentication standards but uses basic authentication by default.
            </p>
            <section class="section" id="driver-authentication-basic">
               <div class="titlepage">
                  <div>
                     <div>
                        <h4 class="title"><a class="anchor" href="index.html#driver-authentication-basic"></a>4.2.3.1.&nbsp;Basic authentication
                        </h4>
                     </div>
                  </div>
               </div>
               <p>The basic authentication scheme is backed by a password file stored within the server and requires applications to provide
                  a user name and password.
                  For this, use the basic auth helper:
               </p>
               <div class="example tabbed-example" id="d0e64818">
                  <div class="example-title">Example&nbsp;4.8.&nbsp;Basic authentication</div>
                  <div class="example tabbed-example-contents">
                     <div class="informalexample include-with-dotnet"><pre class="programlisting highlight"><code data-lang="csharp">public IDriver CreateDriverWithBasicAuth(string uri, string user, string password)
{
    return GraphDatabase.Driver(uri, AuthTokens.Basic(user, password));
}</code></pre></div>
                     <div class="informalexample include-with-java"><pre class="programlisting highlight"><code data-lang="java">public BasicAuthExample( String uri, String user, String password )
{
    driver = GraphDatabase.driver( uri, AuthTokens.basic( user, password ) );
}</code></pre></div>
                     <div class="informalexample include-with-javascript"><pre class="programlisting highlight"><code data-lang="javascript">const driver = neo4j.driver(uri, neo4j.auth.basic(user, password));</code></pre></div>
                     <div class="informalexample include-with-python"><pre class="programlisting highlight"><code data-lang="python">def __init__(self, uri, user, password):
    self._driver = GraphDatabase.driver(uri, auth=(user, password))</code></pre></div>
                  </div>
               </div>
               <div class="admonitionblock note">
                  <table>
                     <tbody>
                        <tr>
                           <td class="icon"><i class="fa icon-note" title="note"></i></td>
                           <td class="content">
                              <p>The basic authentication scheme can also be used to authenticate against an LDAP server.</p>
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </div>
            </section>
            <section class="section" id="_kerberos_authentication">
               <div class="titlepage">
                  <div>
                     <div>
                        <h4 class="title"><a class="anchor" href="index.html#_kerberos_authentication"></a>4.2.3.2.&nbsp;Kerberos authentication
                        </h4>
                     </div>
                  </div>
               </div>
               <p>The Kerberos authentication scheme provides a simple way to create a Kerberos authentication token with a base64 encoded server
                  authentication ticket.
                  The best way to create a Kerberos authentication token is shown below:
               </p>
               <div class="example tabbed-example" id="d0e64841">
                  <div class="example-title">Example&nbsp;4.9.&nbsp;Kerberos authentication</div>
                  <div class="example tabbed-example-contents">
                     <div class="informalexample include-with-dotnet"><pre class="programlisting highlight"><code data-lang="csharp">public IDriver CreateDriverWithKerberosAuth(string uri, string ticket)
{
    return GraphDatabase.Driver(uri, AuthTokens.Kerberos(ticket),
        new Config { EncryptionLevel = EncryptionLevel.None });
}</code></pre></div>
                     <div class="informalexample include-with-java"><pre class="programlisting highlight"><code data-lang="java">public KerberosAuthExample( String uri, String ticket )
{
    driver = GraphDatabase.driver( uri, AuthTokens.kerberos( ticket ) );
}</code></pre></div>
                     <div class="informalexample include-with-javascript"><pre class="programlisting highlight"><code data-lang="javascript">const driver = neo4j.driver(uri, neo4j.auth.kerberos(ticket));</code></pre></div>
                     <div class="informalexample include-with-python"><pre class="programlisting highlight"><code data-lang="python">def __init__(self, uri, ticket):
    self._driver = GraphDatabase.driver(uri, auth=kerberos_auth(ticket))</code></pre></div>
                  </div>
               </div>
               <div class="admonitionblock note">
                  <table>
                     <tbody>
                        <tr>
                           <td class="icon"><i class="fa icon-note" title="note"></i></td>
                           <td class="content">
                              <p>The Kerberos authentication token can only be understood by the server if the server has the <a class="link" href="https://neo4j.com/docs/add-on/kerberos/1.0" target="_top">Kerberos Add-on</a> installed.
                              </p>
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </div>
            </section>
            <section class="section" id="driver-authentication-custom">
               <div class="titlepage">
                  <div>
                     <div>
                        <h4 class="title"><a class="anchor" href="index.html#driver-authentication-custom"></a>4.2.3.3.&nbsp;Custom authentication
                        </h4>
                     </div>
                  </div>
               </div>
               <p>For advanced deployments, where a custom security provider has been built, the custom authentication helper can be used.</p>
               <div class="example tabbed-example" id="d0e64867">
                  <div class="example-title">Example&nbsp;4.10.&nbsp;Custom authentication</div>
                  <div class="example tabbed-example-contents">
                     <div class="informalexample include-with-dotnet"><pre class="programlisting highlight"><code data-lang="csharp">public IDriver CreateDriverWithCustomizedAuth(string uri,
    string principal, string credentials, string realm, string scheme, Dictionary&lt;string, object&gt; parameters)
{
    return GraphDatabase.Driver(uri, AuthTokens.Custom(principal, credentials, realm, scheme, parameters),
        new Config {EncryptionLevel = EncryptionLevel.None});
}</code></pre></div>
                     <div class="informalexample include-with-java"><pre class="programlisting highlight"><code data-lang="java">public CustomAuthExample( String uri, String principal, String credentials, String realm, String scheme,
        Map&lt;String,Object&gt; parameters )
{
    driver = GraphDatabase.driver( uri, AuthTokens.custom( principal, credentials, realm, scheme, parameters ) );
}</code></pre></div>
                     <div class="informalexample include-with-javascript"><pre class="programlisting highlight"><code data-lang="javascript">const driver = neo4j.driver(uri, neo4j.auth.custom(principal, credentials, realm, scheme, parameters));</code></pre></div>
                     <div class="informalexample include-with-python"><pre class="programlisting highlight"><code data-lang="python">def __init__(self, uri, principal, credentials, realm, scheme, **parameters):
    self._driver = GraphDatabase.driver(uri, auth=custom_auth(principal, credentials, realm, scheme, **parameters))</code></pre></div>
                  </div>
               </div>
            </section>
         </section>
         <section class="section" id="driver-configuration">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a class="anchor" href="index.html#driver-configuration"></a>4.2.4.&nbsp;Configuration
                     </h3>
                  </div>
               </div>
            </div>
            <section class="section" id="driver-configuration-encryption">
               <div class="titlepage">
                  <div>
                     <div>
                        <h4 class="title"><a class="anchor" href="index.html#driver-configuration-encryption"></a>4.2.4.1.&nbsp;Encryption
                        </h4>
                     </div>
                  </div>
               </div>
               <p>TLS encryption is enabled for all connections by default.
                  This can be disabled through configuration as follows:
               </p>
               <div class="example tabbed-example" id="d0e64890">
                  <div class="example-title">Example&nbsp;4.11.&nbsp;Unencrypted</div>
                  <div class="example tabbed-example-contents">
                     <div class="informalexample include-with-dotnet"><pre class="programlisting highlight"><code data-lang="csharp">public IDriver CreateDriverWithCustomizedSecurityStrategy(string uri, string user, string password)
{
    return GraphDatabase.Driver(uri, AuthTokens.Basic(user, password),
        new Config {EncryptionLevel = EncryptionLevel.None});
}</code></pre></div>
                     <div class="informalexample include-with-java"><pre class="programlisting highlight"><code data-lang="java">public ConfigUnencryptedExample( String uri, String user, String password )
{
    driver = GraphDatabase.driver( uri, AuthTokens.basic( user, password ),
            Config.build().withoutEncryption().toConfig() );
}</code></pre></div>
                     <div class="informalexample include-with-javascript"><pre class="programlisting highlight"><code data-lang="javascript">const driver = neo4j.driver(uri, neo4j.auth.basic(user, password),
  {
    encrypted: 'ENCRYPTION_OFF'
  }
);</code></pre></div>
                     <div class="informalexample include-with-python"><pre class="programlisting highlight"><code data-lang="python">def __init__(self, uri, user, password):
    self._driver = GraphDatabase.driver(uri, auth=(user, password), encrypted=False)</code></pre></div>
                  </div>
               </div>
               <p>The server can be modified to require encryption for all connections.
                  Please see the <a href="https://neo4j.com/docs/operations-manual/3.4/configuration/connectors/" class="olink">Operations Manual &#8594; Configure Neo4j connectors</a> for more information.
               </p>
               <p>An attempt to connect to a server using an encryption setting not allowed by that server will result in a <a class="link" href="index.html#driver-service-unavailable" title="4.2.5.&nbsp;Service unavailable"><span class="emphasis"><em>Service unavailable</em></span></a> status.
               </p>
            </section>
            <section class="section" id="driver-configuration-trust">
               <div class="titlepage">
                  <div>
                     <div>
                        <h4 class="title"><a class="anchor" href="index.html#driver-configuration-trust"></a>4.2.4.2.&nbsp;Trust
                        </h4>
                     </div>
                  </div>
               </div>
               <p>During a TLS handshake, the server provides a certificate to the client application.
                  The application can choose to accept or reject this certificate based on one of the following trust strategies:
               </p>
               <div class="table" id="d0e64921">
                  <table class="table" summary="Trust strategies" border="1">
                     <caption class="table-title">Table&nbsp;4.3.&nbsp;Trust strategies</caption>
                     <colgroup>
                        <col class="col_1"></col>
                        <col class="col_2"></col>
                     </colgroup>
                     <thead>
                        <tr>
                           <th style="text-align: left; vertical-align: top; ">Trust strategy</th>
                           <th style="text-align: left; vertical-align: top; ">Description</th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr>
                           <td style="text-align: left; vertical-align: top; ">
                              <p><code class="literal">TRUST_ALL_CERTIFICATES</code> (default)
                              </p>
                           </td>
                           <td style="text-align: left; vertical-align: top; ">
                              <p>Accept any certificate provided by the server</p>
                           </td>
                        </tr>
                        <tr>
                           <td style="text-align: left; vertical-align: top; ">
                              <p><code class="literal">TRUST_CUSTOM_CA_SIGNED_CERTIFICATES</code></p>
                           </td>
                           <td style="text-align: left; vertical-align: top; ">
                              <p>Accept any certificate that can be verified against a custom CA</p>
                           </td>
                        </tr>
                        <tr>
                           <td style="text-align: left; vertical-align: top; ">
                              <p><code class="literal">TRUST_SYSTEM_CA_SIGNED_CERTIFICATES</code></p>
                           </td>
                           <td style="text-align: left; vertical-align: top; ">
                              <p>Accept any certificate that can be verified against the system store</p>
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </div>
               <div class="example tabbed-example" id="d0e64959">
                  <div class="example-title">Example&nbsp;4.12.&nbsp;Trust</div>
                  <div class="example tabbed-example-contents">
                     <div class="informalexample include-with-dotnet"><pre class="programlisting highlight"><code data-lang="csharp">public IDriver CreateDriverWithCustomizedTrustStrategy(string uri, string user, string password)
{
    return GraphDatabase.Driver(uri, AuthTokens.Basic(user, password),
        new Config {TrustStrategy = TrustStrategy.TrustAllCertificates});
}</code></pre></div>
                     <div class="informalexample include-with-java"><pre class="programlisting highlight"><code data-lang="java">public ConfigTrustExample( String uri, String user, String password )
{
    driver = GraphDatabase.driver( uri, AuthTokens.basic( user, password ),
            Config.build().withTrustStrategy( Config.TrustStrategy.trustAllCertificates() ).toConfig() );
}</code></pre></div>
                     <div class="informalexample include-with-javascript"><pre class="programlisting highlight"><code data-lang="javascript">const driver = neo4j.driver(uri, neo4j.auth.basic(user, password),
  {
    encrypted: 'ENCRYPTION_ON',
    trust: 'TRUST_ALL_CERTIFICATES'
  }
);</code></pre></div>
                     <div class="informalexample include-with-python"><pre class="programlisting highlight"><code data-lang="python">def __init__(self, uri, user, password):
    self._driver = GraphDatabase.driver(uri, auth=(user, password), trust=TRUST_ALL_CERTIFICATES)</code></pre></div>
                  </div>
               </div>
            </section>
            <section class="section" id="driver-config-connection-pool-management">
               <div class="titlepage">
                  <div>
                     <div>
                        <h4 class="title"><a class="anchor" href="index.html#driver-config-connection-pool-management"></a>4.2.4.3.&nbsp;Connection pool management
                        </h4>
                     </div>
                  </div>
               </div>
               <p>The driver maintains a pool of connections.
                  The pooled connections are reused by sessions and transactions to avoid the overhead added by establishing new connections
                  for every query.
                  The connection pool always starts up empty.
                  New connections are created on demand by sessions and transactions.
                  When a session or a transaction is done with its execution, the connection will be returned to the pool to be reused.
               </p>
               <p>Application users can tune connection pool settings to configure the driver for different use cases based on client performance
                  requirements and database resource consumption limits.
               </p>
               <p>Detailed descriptions of connection pool settings available via driver configuration are listed below:</p>
               <div class="variablelist">
                  <dl class="variablelist">
                     <dt><span class="term"><code class="literal">MaxConnectionLifetime</code></span></dt>
                     <dd>Pooled connections older than this threshold will be closed and removed from the pool.
                        The actual removal happens during connection acquisition so that the new session returned is never backed by an old connection.
                        Setting this option to a low value will cause a high connection churn and might result in a performance drop.
                        It is recommended to pick a value smaller than the maximum lifetime exposed by the surrounding system infrastructure (such
                        as operating system, router, load balancer, proxy and firewall).
                        Negative values result in lifetime not being checked.
                        Default value: 1h.
                     </dd>
                     <dt><span class="term"><code class="literal">MaxConnectionPoolSize</code></span></dt>
                     <dd>This setting defines the maximum total number of connections allowed, per host, to be managed by the connection pool.
                        In other words, for a direct driver, this sets the maximum number of connections towards a single database server.
                        For a routing driver this sets the maximum amount of connections per cluster member.
                        If a session or transaction tries to acquire a connection at a time when the pool size is at its full capacity, it must wait
                        until a free connection is available in the pool or the request to acquire a new connection times out.
                        The connection acquiring timeout is configured via <code class="literal">ConnectionAcquisitionTimeout</code>.
                        Default value: This is different for different drivers, but is a number in the order of 100.
                     </dd>
                     <dt><span class="term"><code class="literal">ConnectionAcquisitionTimeout</code></span></dt>
                     <dd>This setting limits the amount of time a session or transaction can spend waiting for a free connection to appear in the pool
                        before throwing an exception.
                        The exception thrown in this case is <code class="literal">ClientException</code>.
                        Timeout only applies when connection pool is at its max capacity.
                        Default value: 1m.
                     </dd>
                  </dl>
               </div>
               <div class="example tabbed-example" id="d0e65011">
                  <div class="example-title">Example&nbsp;4.13.&nbsp;Connection pool management</div>
                  <div class="example tabbed-example-contents">
                     <div class="informalexample include-with-dotnet"><pre class="programlisting highlight"><code data-lang="csharp">public IDriver CreateDriverWithCustomizedConnectionPool(string uri, string user, string password)
{
    return GraphDatabase.Driver(uri, AuthTokens.Basic(user, password),
        new Config
        {
            MaxConnectionLifetime = TimeSpan.FromMinutes(30),
            MaxConnectionPoolSize = 50,
            ConnectionAcquisitionTimeout = TimeSpan.FromMinutes(2)
        });
}</code></pre></div>
                     <div class="informalexample include-with-java"><pre class="programlisting highlight"><code data-lang="java">public ConfigConnectionPoolExample( String uri, String user, String password )
{
    driver = GraphDatabase.driver( uri, AuthTokens.basic( user, password ), Config.build()
            .withMaxConnectionLifetime( 30, TimeUnit.MINUTES )
            .withMaxConnectionPoolSize( 50 )
            .withConnectionAcquisitionTimeout( 2, TimeUnit.MINUTES )
            .toConfig() );
}</code></pre></div>
                     <div class="informalexample include-with-javascript"><pre class="programlisting highlight"><code data-lang="javascript">const driver = neo4j.driver(uri, neo4j.auth.basic(user, password),
  {
    maxConnectionLifetime: 3 * 60 * 60 * 1000, // 3 hours
    maxConnectionPoolSize: 50,
    connectionAcquisitionTimeout: 2 * 60 * 1000 // 120 seconds
  }
);</code></pre></div>
                     <div class="informalexample include-with-python"><pre class="programlisting highlight"><code data-lang="python">def __init__(self, uri, user, password):
    self._driver = GraphDatabase.driver(uri, auth=(user, password),
                                        max_connection_lifetime=30 * 60, max_connection_pool_size=50,
                                        connection_acquisition_timeout=2 * 60)</code></pre></div>
                  </div>
               </div>
            </section>
            <section class="section" id="driver-configuration-connection-timeout">
               <div class="titlepage">
                  <div>
                     <div>
                        <h4 class="title"><a class="anchor" href="index.html#driver-configuration-connection-timeout"></a>4.2.4.4.&nbsp;Connection timeout
                        </h4>
                     </div>
                  </div>
               </div>
               <p>To configure the maximum time allowed to establish a connection, pass a duration value to the driver configuration.
                  For example:
               </p>
               <div class="example tabbed-example" id="d0e65031">
                  <div class="example-title">Example&nbsp;4.14.&nbsp;Connection timeout</div>
                  <div class="example tabbed-example-contents">
                     <div class="informalexample include-with-dotnet"><pre class="programlisting highlight"><code data-lang="csharp">public IDriver CreateDriverWithCustomizedConnectionTimeout(string uri, string user, string password)
{
    return GraphDatabase.Driver(uri, AuthTokens.Basic(user, password),
        new Config {ConnectionTimeout = TimeSpan.FromSeconds(15)});
}</code></pre></div>
                     <div class="informalexample include-with-java"><pre class="programlisting highlight"><code data-lang="java">public ConfigConnectionTimeoutExample( String uri, String user, String password )
{
    driver = GraphDatabase.driver( uri, AuthTokens.basic( user, password ),
            Config.build().withConnectionTimeout( 15, SECONDS ).toConfig() );
}</code></pre></div>
                     <div class="informalexample include-with-javascript"><pre class="programlisting highlight"><code data-lang="javascript">This feature is not available in the JavaScript driver.</code></pre></div>
                     <div class="informalexample include-with-python"><pre class="programlisting highlight"><code data-lang="python">def __init__(self, uri, user, password):
    self._driver = GraphDatabase.driver(uri, auth=(user, password), connection_timeout=15)</code></pre></div>
                  </div>
               </div>
            </section>
            <section class="section" id="driver-load-balancing-strategy">
               <div class="titlepage">
                  <div>
                     <div>
                        <h4 class="title"><a class="anchor" href="index.html#driver-load-balancing-strategy"></a>4.2.4.5.&nbsp;Load balancing strategy
                        </h4>
                     </div>
                  </div>
               </div>
               <p>A routing driver contains a load balancer to route queries evenly among many cluster members.
                  The built-in load balancer provides two strategies: <code class="literal">least-connected</code> and <code class="literal">round-robin</code>.
                  The <code class="literal">least-connected</code> strategy in general gives a better performance as it takes query execution time and server load into consideration when distributing
                  queries among the cluster members.
                  Default value: <code class="literal">least-connected</code>.
               </p>
               <div class="example tabbed-example" id="d0e65063">
                  <div class="example-title">Example&nbsp;4.15.&nbsp;Load balancing strategy</div>
                  <div class="example tabbed-example-contents">
                     <div class="informalexample include-with-dotnet"><pre class="programlisting highlight"><code data-lang="csharp">public IDriver CreateDriverWithCustomizedLoadBalancingStrategy(string uri, string user, string password)
{
    return GraphDatabase.Driver(uri, AuthTokens.Basic(user, password),
        new Config
        {
            LoadBalancingStrategy = LoadBalancingStrategy.LeastConnected
        });
}</code></pre></div>
                     <div class="informalexample include-with-java"><pre class="programlisting highlight"><code data-lang="java">public ConfigLoadBalancingStrategyExample( String uri, String user, String password )
{
    driver = GraphDatabase.driver( uri, AuthTokens.basic( user, password ), Config.build()
            .withLoadBalancingStrategy( Config.LoadBalancingStrategy.LEAST_CONNECTED )
            .toConfig() );
}</code></pre></div>
                     <div class="informalexample include-with-javascript"><pre class="programlisting highlight"><code data-lang="javascript">const driver = neo4j.driver(uri, neo4j.auth.basic(user, password),
  {
    loadBalancingStrategy: "least_connected"
  }
);</code></pre></div>
                     <div class="informalexample include-with-python"><pre class="programlisting highlight"><code data-lang="python">def __init__(self, uri, user, password):
    self._driver = GraphDatabase.driver(uri, auth=(user, password), load_balancing_strategy=LOAD_BALANCING_STRATEGY_LEAST_CONNECTED)</code></pre></div>
                  </div>
               </div>
            </section>
            <section class="section" id="driver-configuration-max-retry-time">
               <div class="titlepage">
                  <div>
                     <div>
                        <h4 class="title"><a class="anchor" href="index.html#driver-configuration-max-retry-time"></a>4.2.4.6.&nbsp;Max retry time
                        </h4>
                     </div>
                  </div>
               </div>
               <p>To configure retry behavior, supply a value for the maximum time in which to keep attempting retries of transaction functions.
                  For example:
               </p>
               <div class="example tabbed-example" id="d0e65083">
                  <div class="example-title">Example&nbsp;4.16.&nbsp;Max retry time</div>
                  <div class="example tabbed-example-contents">
                     <div class="informalexample include-with-dotnet"><pre class="programlisting highlight"><code data-lang="csharp">public IDriver CreateDriverWithCustomizedMaxRetryTime(string uri, string user, string password)
{
    return GraphDatabase.Driver(uri, AuthTokens.Basic(user, password),
        new Config {MaxTransactionRetryTime = TimeSpan.FromSeconds(15)});
}</code></pre></div>
                     <div class="informalexample include-with-java"><pre class="programlisting highlight"><code data-lang="java">public ConfigMaxRetryTimeExample( String uri, String user, String password )
{
    driver = GraphDatabase.driver( uri, AuthTokens.basic( user, password ),
            Config.build().withMaxTransactionRetryTime( 15, SECONDS ).toConfig() );
}</code></pre></div>
                     <div class="informalexample include-with-javascript"><pre class="programlisting highlight"><code data-lang="javascript">const maxRetryTimeMs = 15 * 1000; // 15 seconds
const driver = neo4j.driver(uri, neo4j.auth.basic(user, password),
  {
    maxTransactionRetryTime: maxRetryTimeMs
  }
);</code></pre></div>
                     <div class="informalexample include-with-python"><pre class="programlisting highlight"><code data-lang="python">def __init__(self, uri, user, password):
    self._driver = GraphDatabase.driver(uri, auth=(user, password), max_retry_time=15)</code></pre></div>
                  </div>
               </div>
               <p>Note that the time specified here does not take into account the running time of the unit of work itself, merely a limit after
                  which retries will no longer be attempted.
               </p>
            </section>
         </section>
         <section class="section" id="driver-service-unavailable">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a class="anchor" href="index.html#driver-service-unavailable"></a>4.2.5.&nbsp;Service unavailable
                     </h3>
                  </div>
               </div>
            </div>
            <p>A Service unavailable status will be signalled when the driver is no longer able to establish communication with the server,
               even after retries.
               Encountering this condition usually indicates a fundamental networking or database problem.
               Applications should be designed to cater for this eventuality.
            </p>
            <div class="example tabbed-example" id="d0e65105">
               <div class="example-title">Example&nbsp;4.17.&nbsp;Service unavailable</div>
               <div class="example tabbed-example-contents">
                  <div class="informalexample include-with-dotnet"><pre class="programlisting highlight"><code data-lang="csharp">public bool AddItem()
{
    try
    {
        using (var session = Driver.Session())
        {
            return session.WriteTransaction(
                tx =&gt;
                {
                    tx.Run("CREATE (a:Item)");
                    return true;
                }
            );
        }
    }
    catch (ServiceUnavailableException)
    {
        return false;
    }
}</code></pre></div>
                  <div class="informalexample include-with-java"><pre class="programlisting highlight"><code data-lang="java">public boolean addItem()
{
    try ( Session session = driver.session() )
    {
        return session.writeTransaction( new TransactionWork&lt;Boolean&gt;()
        {
            @Override
            public Boolean execute( Transaction tx )
            {
                tx.run( "CREATE (a:Item)" );
                return true;
            }
        } );
    }
    catch ( ServiceUnavailableException ex )
    {
        return false;
    }
}</code></pre></div>
                  <div class="informalexample include-with-javascript"><pre class="programlisting highlight"><code data-lang="javascript">const driver = neo4j.driver(uri, neo4j.auth.basic(user, password), {maxTransactionRetryTime: 3000});
const session = driver.session();

const writeTxPromise = session.writeTransaction(tx =&gt; tx.run('CREATE (a:Item)'));

writeTxPromise.catch(error =&gt; {
  if (error.code === neo4j.error.SERVICE_UNAVAILABLE) {
    console.log('Unable to create node: ' + error.code);
  }
});</code></pre></div>
                  <div class="informalexample include-with-python"><pre class="programlisting highlight"><code data-lang="python">def add_item(self):
    try:
        with self._driver.session() as session:
            session.write_transaction(lambda tx: tx.run("CREATE (a:Item)"))
        return True
    except ServiceUnavailable:
        return False</code></pre></div>
               </div>
            </div>
         </section>
      </section>
      <footer><script type="text/javascript">
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
          //Allow Linker
          ga('create', 'UA-1192232-34','auto', {'allowLinker': true});
          ga('send', 'pageview');
          // Load the plugin.
          ga('require', 'linker');
          // Define which domains to autoLink.
          ga('linker:autoLink', ['neo4j.org','neo4j.com','neotechnology.com','graphdatabases.com','graphconnect.com']);
        </script><script type="text/javascript">
          document.write(unescape("%3Cscript src='//munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
        </script><script>Munchkin.init('773-GON-065');</script></footer>
   </body>
</html>